# Vulnerability Information
- CVE Identifier: CVE-2019-11048
- Title: Disk Space Exhaustion Attack in PHP File Uploads
- Date Discovered: 2019-04-16
- Affected Versions: PHP versions 7.2.x below 7.2.31, 7.3.x below 7.3.18 and 7.4.x below 7.4.6
- Fixed Versions: PHP versions 7.2.31, 7.3.18 and 7.4.6

## Overview
This vulnerability allows an attacker to exhaust the disk space on a victim's server by uploading files with overly long filenames or field names.

## Description
When PHP processes HTTP file uploads, it allocates memory storage for the filenames and field names. If the filenames or field names are too long, PHP will hit the memory limit and stop processing the request. However, PHP will not clean up the temporary files that were created for the upload request. This can lead to an accumulation of temporary files, which can eventually exhaust the disk space on the server.

## Exploitation
An attacker could exploit this vulnerability by uploading files with overly long filenames or field names to a vulnerable server. If the server has a low memory limit, PHP will hit the memory limit and stop processing the request. However, the temporary files created for the upload request will not be cleaned up. The attacker can then repeat this process to upload more files, until the disk space on the server is exhausted.

### Vulnerable code of Disk Space Exhaustion Attack in PHP File Uploads 

```php
<?php
// Upload the file to the server.
$url = 'http://example.com/upload.php';
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, array('file' => new CURLFile($_FILES['file']['tmp_name'])));
curl_exec($ch);

// Close the curl session.
curl_close($ch);
```

This code is vulnerable because it does not check the file size before uploading it. This means that an attacker could upload a file of any size, including a file that is too large for the server to handle.

## Mitigation
To mitigate this vulnerability, you should upgrade to a fixed version of PHP. If you are unable to upgrade, you can mitigate the risk by increasing the memory limit for PHP. You should also set a maximum file size limit for uploads.

## Mitigated code of Disk Space Exhaustion Attack in PHP File Uploads 

```php
<?php
// Check the file size.
if ($_FILES['file']['size'] > 100000) {
    // The file is too large.
    echo 'The file is too large. Please upload a file that is smaller than 100KB.';
    exit();
}

// Upload the file to the server.
$url = 'http://example.com/upload.php';
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, array('file' => new CURLFile($_FILES['file']['tmp_name'])));
curl_exec($ch);

// Close the curl session.
curl_close($ch);
```

This code will check the file size before uploading it. If the file size is greater than 100KB, then the code will print an error message and exit the script.


## References
[CVE-2019-11048](https://nvd.nist.gov/vuln/detail/CVE-2019-11048)
