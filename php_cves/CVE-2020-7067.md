# Vulnerability Information
- CVE Identifier: CVE-2020-7067
- Title: Buffer Over-Read in urldecode() Function
- Date Discovered: 2020-03-18
- Affected Versions: PHP versions 7.2.x below 7.2.30, 7.3.x below 7.3.17 and 7.4.x below 7.4.5
- Fixed Versions: PHP versions 7.2.30, 7.3.17 and 7.4.5

## Overview
This vulnerability allows an attacker to disclose information or cause a crash on a victim's computer by exploiting a buffer over-read in the urldecode() function.

## Description
The urldecode() function in PHP is used to decode URL-encoded strings. If the input to the urldecode() function is malicious, it can lead to a buffer over-read, which can allow an attacker to disclose information or cause a crash on the victim's computer.

## Exploitation
An attacker could exploit this vulnerability by sending a malicious URL to the victim. If the victim's computer is using a vulnerable version of PHP and EBCDIC support is enabled, the victim's computer will try to decode the URL using the urldecode() function. The malicious URL could cause the urldecode() function to crash, disclosing information or causing a crash on the victim's computer.

### Vulnerable Code of Buffer Over-Read in urldecode() Function implementation

The following code shows an example of a malicious URL that could be used to exploit this vulnerability:

    http://example.com/%E1%80%80

```php
function urldecode($str) {
    $output = "";
    $l = strlen($str);
    for ($i = 0; $i < $l; $i++) {
        if ($str[$i] == '%') {
            if ($str[$i + 1] == '%') {
                $output .= '%';
                $i++;
            } else {
                $output .= chr(hexdec($str[$i + 1] . $str[$i + 2]));
                $i += 2;
            }
        } else {
            $output .= $str[$i];
        }
    }
    return $output;
}
```

This code is vulnerable because it does not properly validate the input string. If the input string contains malicious characters, the code can overflow the buffer and allow the attacker to execute arbitrary code.

## Mitigation
To mitigate this vulnerability, you should upgrade to a fixed version of PHP. If you are unable to upgrade, you can mitigate the risk by disabling EBCDIC support or by using the below code of corrected urldecode implementation.

## Mitigated implementation of the urldecode() function

```php
function urldecode($str) {
    $output = "";
    $l = strlen($str);
    for ($i = 0; $i < $l; $i++) {
        if ($str[$i] == '%') {
            // Validate the next two characters
            if ($str[$i + 1] == '%' || !ctype_xdigit($str[$i + 1]) || !ctype_xdigit($str[$i + 2])) {
                // The input string is malicious
                return false;
            }

            // Decode the character
            $output .= chr(hexdec($str[$i + 1] . $str[$i + 2]));
            $i += 2;
        } else {
            $output .= $str[$i];
        }
    }
    return $output;
}
```

This code validates the next two characters of the input string before decoding them. If the next two characters are not valid hexadecimal characters, the code returns false. This prevents the attacker from overflowing the buffer and executing arbitrary code.

## References
[CVE-2020-7067](https://nvd.nist.gov/vuln/detail/CVE-2020-7067)
