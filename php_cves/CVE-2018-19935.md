# Vulnerability Information
- CVE Identifier: CVE-2018-19935
- Title: Denial of Service in PHP imap_mail() Function
- Date Discovered: 2018-08-01
- Affected Versions: PHP 5.x and 7.x before 7.3.0
- Fixed Versions: PHP 7.3.0

## Overview
This vulnerability allows a remote attacker to cause a denial of service (DoS) on a victim's computer by exploiting a NULL pointer dereference in the imap_mail() function.

## Description
The `imap_mail()` function in PHP is used to send an email message. If the message argument to the `imap_mail()` function is an empty string, the function will dereference a NULL pointer, causing the application to crash.

## Exploitation
An attacker could exploit this vulnerability by sending a malicious email message to the victim. If the victim's computer is using a vulnerable version of PHP, the malicious email message will cause the `imap_mail()` function to crash, causing the application to crash.

### Vulnerable implementation of the `imap_mail()`

```php
<?php

function send_email($to_address, $from_address, $subject, $message) {
  // Connect to the mail server.
  $conn = imap_open('{localhost:143/imap/ssl}', 'username', 'password');

  // Select the 'Sent' mailbox.
  imap_select($conn, 'Sent');

  // Send the email message.
  imap_mail($to_address, $from_address, $subject, $message);

  // Close the connection to the mail server.
  imap_close($conn);
}

// Send an email message with an empty message body.
send_email('victim@example.com', 'attacker@example.com', 'Test Message', '');

?>
```
This code is vulnerable because the `imap_mail()` function is called with an empty message body. This can be exploited by an attacker to cause a `denial of service (DoS)` attack by sending a malicious email message to the victim. When the victim's computer tries to process the email message, the `imap_mail()` function will dereference a NULL pointer, causing the application to crash.

## Mitigation
To mitigate this vulnerability, you should upgrade to a fixed version of PHP. If you are unable to upgrade, you can mitigate the risk by using a library to validate the message argument to the imap_mail() function before calling the function.

## Mitigated implementation of the `imap_mail()`

```php
<?php

function send_email($to_address, $from_address, $subject, $message) {
  // Validate the message argument.
  if (!$message) {
    throw new Exception('The message argument cannot be empty.');
  }

  // Connect to the mail server.
  $conn = imap_open('{localhost:143/imap/ssl}', 'username', 'password');

  // Select the 'Sent' mailbox.
  imap_select($conn, 'Sent');

  // Send the email message.
  imap_mail($to_address, $from_address, $subject, $message);

  // Close the connection to the mail server.
  imap_close($conn);
}

// Send an email message with a valid message body.
send_email('victim@example.com', 'attacker@example.com', 'Test Message', 'This email message contains a valid message body.');

?>
```

This code validates the message argument before calling the `imap_mail()` function, which helps to mitigate the risk of the DoS vulnerability.

## References
[CVE-2018-19935](https://nvd.nist.gov/vuln/detail/CVE-2018-19935)
