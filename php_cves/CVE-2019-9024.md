# Vulnerability Information
- CVE Identifier: CVE-2019-9024
- Title: Buffer Over-Read in PHP xmlrpc_decode() Function
- Date Discovered: 2019-02-22
- Affected Versions: PHP before 5.6.40, 7.x before 7.1.26, 7.2.x before 7.2.14, and 7.3.x before 7.3.1
- Fixed Versions: PHP 5.6.40, PHP 7.1.26, PHP 7.2.14, and PHP 7.3.1

## Overview
This vulnerability allows an attacker to execute arbitrary code on a victim's computer by exploiting a buffer over-read in the PHP xmlrpc_decode() function.

## Description
The `xmlrpc_decode()` function in PHP is used to decode XML-RPC responses. If the input to the function is malicious, it can lead to a buffer over-read, which can allow an attacker to execute arbitrary code on the victim's computer.

## Exploitation
An attacker could exploit this vulnerability by sending a malicious `XML-RPC` request to a victim's website. If the victim's website is using a vulnerable version of PHP, the attacker's request could cause the xmlrpc_decode() function to crash, leading to arbitrary code execution.

The following code shows an example of a malicious `XML-RPC` request that could be used to exploit this vulnerability:
XML

```xml
<?xml version="1.0" encoding="UTF-8"?>
<methodCall>
  <methodName>system</methodName>
  <params>
    <param>
      <value><string>/bin/sh</string></value>
    </param>
  </params>
</methodCall>
```

This request will cause the `xmlrpc_decode()` function to execute the `/bin/sh` shell on the victim's computer.

### Vulnerable implementation of the Buffer Over-Read in PHP xmlrpc_decode() Function

```php
<?php
function xmlrpc_decode($xml_data) {
  $parser = xmlrpc_parser_create();
  xmlrpc_parser_set_option($parser, XMLRPC_OPTION_SKIP_WHITE, 1);
  xmlrpc_parser_set_option($parser, XMLRPC_OPTION_CASE_FOLDING, 1);
  xmlrpc_parser_set_option($parser, XMLRPC_OPTION_FREE_MEM, 1);

  // This is the vulnerable line.
  $parser->input = $xml_data;

  $result = xmlrpc_parse($parser);

  xmlrpc_parser_free($parser);

  return $result;
}
```

This vulnerability can be exploited by sending a malicious XML-RPC request with a large base64-encoded string. When the `xmlrpc_decode()` function attempts to decode the string, it will overflow an integer buffer, which can allow the attacker to overwrite adjacent memory locations.

## Mitigation
To mitigate this vulnerability, you should upgrade to a fixed version of PHP. If you are unable to upgrade, you should disable the `xmlrpc_decode()` function.

## Mitigated implementation of the Buffer Over-Read in PHP xmlrpc_decode() Function
To correct this vulnerability, we can add a check to ensure that the length of the XML-RPC request is not too large. We can also use a safe decoding function, such as base64_decode_safe(), to decode the base64-encoded string.

```php
<?php
function xmlrpc_decode($xml_data) {
  if (strlen($xml_data) > 1024 * 1024) {
    return false;
  }

  $parser = xmlrpc_parser_create();
  xmlrpc_parser_set_option($parser, XMLRPC_OPTION_SKIP_WHITE, 1);
  xmlrpc_parser_set_option($parser, XMLRPC_OPTION_CASE_FOLDING, 1);
  xmlrpc_parser_set_option($parser, XMLRPC_OPTION_FREE_MEM, 1);

  // Use a safe decoding function.
  $parser->input = base64_decode_safe($xml_data);

  $result = xmlrpc_parse($parser);

  xmlrpc_parser_free($parser);

  return $result;
}
```

This corrected implementation will not be vulnerable to buffer over-read attacks, as it will check the length of the XML-RPC request and use a safe decoding function.

## References
[CVE-2019-9024](https://nvd.nist.gov/vuln/detail/CVE-2019-9024)
