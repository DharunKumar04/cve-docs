# Vulnerability Information
- CVE Identifier: CVE-2020-7066
- Title: URL Truncation in get_headers() Function
- Date Discovered: 2020-03-18
- Affected Versions: PHP versions 7.2.x below 7.2.29, 7.3.x below 7.3.16 and 7.4.x below 7.4.4
- Fixed Versions: PHP versions 7.2.29, 7.3.16 and 7.4.4

## Overview
This vulnerability allows an attacker to redirect a victim's request to a malicious server by exploiting a URL truncation vulnerability in the get_headers() function.

## Description
The get_headers() function in PHP is used to retrieve the HTTP headers for a given URL. If the URL contains a zero (\0) character, the URL will be silently truncated at it. This can cause some software to make incorrect assumptions about the target of the get_headers() and possibly send some information to a wrong server.

## Exploitation
An attacker could exploit this vulnerability by sending a malicious URL to the victim. If the victim's computer is using a vulnerable version of PHP, the victim's request will be redirected to the attacker's server. The attacker could then use this to steal the victim's cookies or other sensitive information.

The following code shows an example of a malicious URL that could be used to exploit this vulnerability:

    https://example.com\0attacker.com/

This URL contains a zero (\0) character after the example.com domain name. When the victim's computer tries to access this URL, the get_headers() function will truncate the URL at the zero character. This will cause the victim's request to be redirected to the attacker's server at attacker.com.

### Vulnerable code of URL Truncation in get_headers() Function

```php
function get_headers_vulnerable($url) {
  $headers = get_headers($url);
  if ($headers === false) {
    return false;
  }

  return $headers;
}
```

The vulnerable code does not check the URL for the presence of a zero (\0) character. This allows an attacker to exploit the vulnerability by sending a malicious URL that contains a zero character

## Mitigation
To mitigate this vulnerability, you should upgrade to a fixed version of PHP. If you are unable to upgrade, you can mitigate the risk by using a library to validate the URL argument to the get_headers() function before calling the function.

## Mitigated code of URL Truncation in get_headers() Function

```php
function get_headers_corrected($url) {
  if (strpos($url, "\0") !== false) {
    return false;
  }

  $headers = get_headers($url);
  if ($headers === false) {
    return false;
  }

  return $headers;
}
```

The corrected code checks the URL for the presence of a zero character before calling the get_headers() function. If the URL contains a zero character, the function returns false.

## References
[CVE-2020-7066](https://nvd.nist.gov/vuln/detail/CVE-2020-7066)
